# ESP32 Course Platform

Interactive teaching platform for ESP32 course with real-time quizzes and student engagement.
Vibe coding By Modulemore via ChatGPT

## Features

- **Teacher Dashboard**: Create and push quizzes, see online students, track responses
- **Student Interface**: Course content with real-time quiz notifications
- **Real-time Communication**: WebSocket-based push notifications
- **Quiz Types**: Text answers and multiple choice questions  
- **Response Tracking**: Monitor student engagement, answer times, and completion rates
- **Timeout Handling**: Configurable quiz timeouts with automatic status updates

## Quick Start

### Prerequisites

- Node.js 16+ 
- npm or yarn

### Installation

1. Install dependencies:
```bash
npm install
```

2. Bootstrap the demo database:
```bash
npm run bootstrap
```

> **Note:** This script removes any existing `database.sqlite` before recreating demo data.

3. Start the server:
```bash
npm start
```

4. Open your browser to `http://localhost:3000`

### Demo Accounts

- **Teacher**: username=`teacher`, password=`admin123`
- **Students**: `student1` - `student50`, password=`student123`
- **Course Passkey**: `JOIN-ESP32` (generated by the bootstrap script)

## Usage

### For Teachers

1. Login with teacher credentials
2. Create quizzes using the form (text or multiple choice)
3. Push quizzes to all online students
4. Monitor real-time responses and engagement
5. Undo quiz pushes if needed

### For Students

1. Login with student credentials
2. View course content on the main page
3. Receive quiz notifications as overlays
4. Submit answers within the time limit
5. See confirmation when answers are submitted

## Architecture

- **Backend**: Node.js + Express + Socket.IO + SQLite
- **Frontend**: Vanilla HTML/CSS/JavaScript with Socket.IO client
- **Database**: SQLite for demo (easily switchable to PostgreSQL)
- **Real-time**: WebSocket connections for live quiz distribution

## API Endpoints

### Authentication
- `POST /api/login` - User authentication
- `GET /api/me` - Get current user info

### Quizzes (Teacher only)
- `GET /api/quizzes` - List teacher's quizzes
- `POST /api/quizzes` - Create new quiz
- `POST /api/pushes` - Push quiz to students  
- `POST /api/pushes/:id/undo` - Undo quiz push

### Students
- `GET /api/students/online` - List online students (teacher only)

## WebSocket Events

### Authentication
- `auth` - Authenticate with JWT token
- `auth_ok` / `auth_error` - Authentication responses

### Quiz Flow
- `quiz_push` - Server pushes quiz to students
- `quiz_answer` - Student submits answer
- `quiz_response` - Server notifies teachers of responses
- `quiz_undo` - Server cancels active quiz
- `quiz_timeout` - Quiz timeout notification

### Presence
- `online_students` - Updates list of connected students

## Development

### Database Schema

The platform uses these main tables:
- `users` - User accounts (teachers/students)
- `quizzes` - Quiz definitions  
- `quiz_pushes` - Quiz distribution instances
- `quiz_responses` - Student answers and engagement data

### File Structure

```
├── server.js           # Main server application
├── schema.sql          # Database schema
├── scripts/
│   ├── bootstrapDemo.js  # Combined wipe + seed helper
│   ├── createTeacher.js  # Standalone teacher seeding utility
│   ├── createStudents.js # Standalone student batch creator
│   └── seedQuizzes.js    # Standalone quiz seeding utility
├── public/
│   ├── index.html     # Login page
│   ├── teacher.html   # Teacher dashboard
│   └── student.html   # Student interface
└── package.json       # Dependencies and scripts
```

## Deployment on Debian 10

### System Setup

1. Install Node.js:
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

2. Create application user:
```bash
sudo useradd -m -s /bin/bash esp32course
sudo su - esp32course
```

3. Clone and setup:
```bash
git clone <your-repo> esp32-course-platform
cd esp32-course-platform
npm install --production
npm run init-db
```

### systemd Service

Create `/etc/systemd/system/esp32course.service`:

```ini
[Unit]
Description=ESP32 Course Platform
After=network.target

[Service]
Type=simple
User=esp32course
WorkingDirectory=/home/esp32course/esp32-course-platform
ExecStart=/usr/bin/node server.js
Restart=always
RestartSec=10
Environment=NODE_ENV=production
Environment=PORT=3000

[Install]
WantedBy=multi-user.target
```

Start service:
```bash
sudo systemctl enable esp32course
sudo systemctl start esp32course
```

### Nginx Reverse Proxy

Install nginx:
```bash
sudo apt update
sudo apt install nginx
```

Create `/etc/nginx/sites-available/esp32course`:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3030;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

Enable site:
```bash
sudo ln -s /etc/nginx/sites-available/esp32course /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

### SSL with Let's Encrypt

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

## Production Considerations

### Security
- Change JWT_SECRET in production
- Use environment variables for sensitive config
- Enable HTTPS/SSL
- Implement rate limiting
- Add input validation and sanitization

### Database
- Switch to PostgreSQL for better concurrency:
```bash
sudo apt install postgresql postgresql-contrib
sudo -u postgres createdb esp32course
```

- Update connection in `server.js` to use `pg` package

### Monitoring
- Add logging with winston
- Monitor with PM2 or systemd
- Set up health checks
- Monitor WebSocket connections

### Scaling
- Use Redis for WebSocket session storage
- Load balance with multiple Node.js instances  
- Separate database server
- CDN for static assets

## Troubleshooting

### Common Issues

1. **Port already in use**: Change PORT in environment or stop conflicting process
2. **Database locked**: Ensure SQLite file permissions are correct
3. **WebSocket connection fails**: Check firewall and proxy settings
4. **Students don't receive quizzes**: Verify authentication and WebSocket connection

### Logs

Check application logs:
```bash
sudo journalctl -u esp32course -f
```

### Database

View database content:
```bash
sqlite3 database.sqlite
.tables
SELECT * FROM users;
```

## License

MIT License - see LICENSE file for details.